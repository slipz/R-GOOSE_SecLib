<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>R-GOOSE_SecLib: src/r_goose_security.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">R-GOOSE_SecLib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">r_goose_security.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>File containing HMAC, GMAC and AES related imports, as well as the declarations of several R-GOOSE Protocol related constants. The functions on .c file are responsible to ensure security properties to R-GOOSE messages.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="hmac__functions_8h_source.html">hmac_functions.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="gmac__functions_8h_source.html">gmac_functions.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="aes__crypto_8h_source.html">aes_crypto.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="aux__funcs_8h_source.html">aux_funcs.h</a>&quot;</code><br />
</div>
<p><a href="r__goose__security_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a62dde324474cad53d5fefb13814fee9b"><td class="memItemLeft" align="right" valign="top"><a id="a62dde324474cad53d5fefb13814fee9b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAC_NONE</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a62dde324474cad53d5fefb13814fee9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e77f84eeba293b6996401934355bc39"><td class="memItemLeft" align="right" valign="top"><a id="a4e77f84eeba293b6996401934355bc39"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>HMAC_SHA256_80</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a4e77f84eeba293b6996401934355bc39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf6c50ebb453c27e0f08364259dfd89a"><td class="memItemLeft" align="right" valign="top"><a id="aaf6c50ebb453c27e0f08364259dfd89a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>HMAC_SHA256_128</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:aaf6c50ebb453c27e0f08364259dfd89a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a621283adca2a78bf843248d33cdb052d"><td class="memItemLeft" align="right" valign="top"><a id="a621283adca2a78bf843248d33cdb052d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>HMAC_SHA256_256</b>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a621283adca2a78bf843248d33cdb052d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae241f0922d8180f131c660f1b70f857b"><td class="memItemLeft" align="right" valign="top"><a id="ae241f0922d8180f131c660f1b70f857b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GMAC_AES256_64</b>&#160;&#160;&#160;4</td></tr>
<tr class="separator:ae241f0922d8180f131c660f1b70f857b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad884a526e3c39f9176546da8bf721526"><td class="memItemLeft" align="right" valign="top"><a id="ad884a526e3c39f9176546da8bf721526"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GMAC_AES256_128</b>&#160;&#160;&#160;5</td></tr>
<tr class="separator:ad884a526e3c39f9176546da8bf721526"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fcf56aae1ecad957bc0e2c622f765f6"><td class="memItemLeft" align="right" valign="top"><a id="a1fcf56aae1ecad957bc0e2c622f765f6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>HMAC_BLAKE2B_80</b>&#160;&#160;&#160;6</td></tr>
<tr class="separator:a1fcf56aae1ecad957bc0e2c622f765f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2be0c9532f56cbf3ebfdb56e26d1f2c"><td class="memItemLeft" align="right" valign="top"><a id="ae2be0c9532f56cbf3ebfdb56e26d1f2c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>HMAC_BLAKE2S_80</b>&#160;&#160;&#160;7</td></tr>
<tr class="separator:ae2be0c9532f56cbf3ebfdb56e26d1f2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a619d1117d58d444d3ac87c0be246f1e3"><td class="memItemLeft" align="right" valign="top"><a id="a619d1117d58d444d3ac87c0be246f1e3"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GMAC_AES128_64</b>&#160;&#160;&#160;8</td></tr>
<tr class="separator:a619d1117d58d444d3ac87c0be246f1e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67119f8f929cbf71ea50b9c3e4322a05"><td class="memItemLeft" align="right" valign="top"><a id="a67119f8f929cbf71ea50b9c3e4322a05"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GMAC_AES128_128</b>&#160;&#160;&#160;9</td></tr>
<tr class="separator:a67119f8f929cbf71ea50b9c3e4322a05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82693f41ed6427e08695e7c74e36ec9c"><td class="memItemLeft" align="right" valign="top"><a id="a82693f41ed6427e08695e7c74e36ec9c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ENC_NONE</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a82693f41ed6427e08695e7c74e36ec9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9558f08e8103b016a428ad41a7055e2"><td class="memItemLeft" align="right" valign="top"><a id="ab9558f08e8103b016a428ad41a7055e2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>AES_128_GCM</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ab9558f08e8103b016a428ad41a7055e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f420347f6443efcdb936a3b36c8fc85"><td class="memItemLeft" align="right" valign="top"><a id="a7f420347f6443efcdb936a3b36c8fc85"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>AES_256_GCM</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a7f420347f6443efcdb936a3b36c8fc85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10f3366dd3d0f0bae10cebc5c1fbabc0"><td class="memItemLeft" align="right" valign="top"><a id="a10f3366dd3d0f0bae10cebc5c1fbabc0"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_SPDU_LENGTH</b>&#160;&#160;&#160;6</td></tr>
<tr class="separator:a10f3366dd3d0f0bae10cebc5c1fbabc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abeef003f4df4dacfdef8d18608db9610"><td class="memItemLeft" align="right" valign="top"><a id="abeef003f4df4dacfdef8d18608db9610"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_SPDU_NUMBER</b>&#160;&#160;&#160;10</td></tr>
<tr class="separator:abeef003f4df4dacfdef8d18608db9610"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0374757e18994f31aa66875c4311422"><td class="memItemLeft" align="right" valign="top"><a id="ad0374757e18994f31aa66875c4311422"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_VERSION_NUMBER</b>&#160;&#160;&#160;14</td></tr>
<tr class="separator:ad0374757e18994f31aa66875c4311422"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e96756621dae323655e120e314c2f24"><td class="memItemLeft" align="right" valign="top"><a id="a4e96756621dae323655e120e314c2f24"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_SECURITY_INFO</b>&#160;&#160;&#160;16</td></tr>
<tr class="separator:a4e96756621dae323655e120e314c2f24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2883615f67c03c0bc797ff63da422c35"><td class="memItemLeft" align="right" valign="top"><a id="a2883615f67c03c0bc797ff63da422c35"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_TIMECURKEY</b>&#160;&#160;&#160;16</td></tr>
<tr class="separator:a2883615f67c03c0bc797ff63da422c35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea81e5b776372640159566be34eaa910"><td class="memItemLeft" align="right" valign="top"><a id="aea81e5b776372640159566be34eaa910"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_TIMENEXTKEY</b>&#160;&#160;&#160;20</td></tr>
<tr class="separator:aea81e5b776372640159566be34eaa910"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5342b9140a5932c01229d064e4995343"><td class="memItemLeft" align="right" valign="top"><a id="a5342b9140a5932c01229d064e4995343"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_ENCRYPTION_ALG</b>&#160;&#160;&#160;22</td></tr>
<tr class="separator:a5342b9140a5932c01229d064e4995343"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45bcbf142381cc58c6da939421ccbd0a"><td class="memItemLeft" align="right" valign="top"><a id="a45bcbf142381cc58c6da939421ccbd0a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_MAC_ALG</b>&#160;&#160;&#160;23</td></tr>
<tr class="separator:a45bcbf142381cc58c6da939421ccbd0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afda0c1a015e232b53226cc99f282bc1f"><td class="memItemLeft" align="right" valign="top"><a id="afda0c1a015e232b53226cc99f282bc1f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_KEYID</b>&#160;&#160;&#160;24</td></tr>
<tr class="separator:afda0c1a015e232b53226cc99f282bc1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af72aa3600af34e0549e86a89538c6061"><td class="memItemLeft" align="right" valign="top"><a id="af72aa3600af34e0549e86a89538c6061"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_LENGTH</b>&#160;&#160;&#160;28</td></tr>
<tr class="separator:af72aa3600af34e0549e86a89538c6061"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab98ae9439e06e1cdc1cd2025cfdd50a8"><td class="memItemLeft" align="right" valign="top"><a id="ab98ae9439e06e1cdc1cd2025cfdd50a8"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_PAYLOAD_TYPE</b>&#160;&#160;&#160;32</td></tr>
<tr class="separator:ab98ae9439e06e1cdc1cd2025cfdd50a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d1bf664856e4f263ea29dfdf32e91f5"><td class="memItemLeft" align="right" valign="top"><a id="a2d1bf664856e4f263ea29dfdf32e91f5"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_SIMULATION</b>&#160;&#160;&#160;33</td></tr>
<tr class="separator:a2d1bf664856e4f263ea29dfdf32e91f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cf27a2a6f134bc927505306c9546513"><td class="memItemLeft" align="right" valign="top"><a id="a1cf27a2a6f134bc927505306c9546513"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_APPID</b>&#160;&#160;&#160;34</td></tr>
<tr class="separator:a1cf27a2a6f134bc927505306c9546513"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3834ea86286767884fb5921fba7f5ed2"><td class="memItemLeft" align="right" valign="top"><a id="a3834ea86286767884fb5921fba7f5ed2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_APDU_LENGTH</b>&#160;&#160;&#160;36</td></tr>
<tr class="separator:a3834ea86286767884fb5921fba7f5ed2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa15402cc8e96e2175e6a170c6e444980"><td class="memItemLeft" align="right" valign="top"><a id="aa15402cc8e96e2175e6a170c6e444980"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INDEX_PAYLOAD</b>&#160;&#160;&#160;38</td></tr>
<tr class="separator:aa15402cc8e96e2175e6a170c6e444980"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab36f165524ae0178166b93bcfc9d8e7b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="r__goose__security_8h.html#ab36f165524ae0178166b93bcfc9d8e7b">r_gooseMessage_InsertHMAC</a> (uint8_t *buffer, uint8_t *key, size_t key_size, int alg)</td></tr>
<tr class="memdesc:ab36f165524ae0178166b93bcfc9d8e7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that generate and insert an HMAC Tag into an R-GOOSE message.  <a href="r__goose__security_8h.html#ab36f165524ae0178166b93bcfc9d8e7b">More...</a><br /></td></tr>
<tr class="separator:ab36f165524ae0178166b93bcfc9d8e7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6a00bd3ec7cc19913cf4cbb065f0bd6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="r__goose__security_8h.html#ad6a00bd3ec7cc19913cf4cbb065f0bd6">r_gooseMessage_InsertGMAC</a> (uint8_t *buffer, uint8_t *key, size_t key_size, int alg)</td></tr>
<tr class="memdesc:ad6a00bd3ec7cc19913cf4cbb065f0bd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that generate and insert an GMAC Tag into an R-GOOSE message.  <a href="r__goose__security_8h.html#ad6a00bd3ec7cc19913cf4cbb065f0bd6">More...</a><br /></td></tr>
<tr class="separator:ad6a00bd3ec7cc19913cf4cbb065f0bd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11691f1350b5aa209c05c76f223a83ef"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="r__goose__security_8h.html#a11691f1350b5aa209c05c76f223a83ef">r_gooseMessage_ValidateHMAC</a> (uint8_t *buffer, uint8_t *key, size_t key_size)</td></tr>
<tr class="memdesc:a11691f1350b5aa209c05c76f223a83ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that validates or invalidates an R-GOOSE message containing an HMAC Tag.  <a href="r__goose__security_8h.html#a11691f1350b5aa209c05c76f223a83ef">More...</a><br /></td></tr>
<tr class="separator:a11691f1350b5aa209c05c76f223a83ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5e7870fb388bedaac144151024c8308"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="r__goose__security_8h.html#af5e7870fb388bedaac144151024c8308">r_gooseMessage_ValidateGMAC</a> (uint8_t *buffer, uint8_t *key, size_t key_size)</td></tr>
<tr class="memdesc:af5e7870fb388bedaac144151024c8308"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that validates or invalidates an R-GOOSE message containing an GMAC Tag.  <a href="r__goose__security_8h.html#af5e7870fb388bedaac144151024c8308">More...</a><br /></td></tr>
<tr class="separator:af5e7870fb388bedaac144151024c8308"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2d26cddbf81e39943e7f6db8f4753ec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="r__goose__security_8h.html#af2d26cddbf81e39943e7f6db8f4753ec">r_gooseMessage_Encrypt</a> (uint8_t *buffer, uint8_t *key, int alg, uint32_t timeOfCurrentKey, uint16_t timeToNextKey, uint32_t key_id, uint8_t *iv, int iv_size)</td></tr>
<tr class="memdesc:af2d26cddbf81e39943e7f6db8f4753ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that encrypts the GOOSE payload of an R-GOOSE message.  <a href="r__goose__security_8h.html#af2d26cddbf81e39943e7f6db8f4753ec">More...</a><br /></td></tr>
<tr class="separator:af2d26cddbf81e39943e7f6db8f4753ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2233d1cff4fb1f4558b383f2ede6680"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="r__goose__security_8h.html#ae2233d1cff4fb1f4558b383f2ede6680">r_gooseMessage_Decrypt</a> (uint8_t *buffer, uint8_t *key, uint8_t *iv, int iv_size)</td></tr>
<tr class="memdesc:ae2233d1cff4fb1f4558b383f2ede6680"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that decrypts the GOOSE payload of an R-GOOSE message.  <a href="r__goose__security_8h.html#ae2233d1cff4fb1f4558b383f2ede6680">More...</a><br /></td></tr>
<tr class="separator:ae2233d1cff4fb1f4558b383f2ede6680"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7590c8b58b8ea2be81661365d4eccf46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="r__goose__security_8h.html#a7590c8b58b8ea2be81661365d4eccf46">r_goose_dissect</a> (uint8_t *buffer)</td></tr>
<tr class="memdesc:a7590c8b58b8ea2be81661365d4eccf46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that dissects and prints the R-GOOSE message.  <a href="r__goose__security_8h.html#a7590c8b58b8ea2be81661365d4eccf46">More...</a><br /></td></tr>
<tr class="separator:a7590c8b58b8ea2be81661365d4eccf46"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a7b6511ce30aa517f2d453d83af03a15c"><td class="memItemLeft" align="right" valign="top"><a id="a7b6511ce30aa517f2d453d83af03a15c"></a>
const int&#160;</td><td class="memItemRight" valign="bottom"><b>MAC_SIZES</b> []</td></tr>
<tr class="separator:a7b6511ce30aa517f2d453d83af03a15c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>File containing HMAC, GMAC and AES related imports, as well as the declarations of several R-GOOSE Protocol related constants. The functions on .c file are responsible to ensure security properties to R-GOOSE messages. </p>
<dl class="section author"><dt>Author</dt><dd>Eduardo Andrade </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Mar 2020 The functions implemented use the following R-GOOSE packet structure: <pre class="fragment">        - LI                            = 0x01
        - TI                            = 0x40
        - Session Identifier            = 1-byte
        - LI                            = 1-byte
        - Common Header                 = 1-byte
        - LI                            = 1-byte
        - SPDU Length                   = 4-byte
        - SPDU Number                   = 4-byte
        - Version Number                = 2-byte

        - TimeOfCurrentKey              = 4-byte
        - TimeToNextKey                 = 2-byte
        - Security Information       
            - Encryption Algorithm      = 1-byte
            - MAC Algorithm             = 1-byte
        - Key ID                        = 4-byte

        - Length                        = 4-byte
        - Payload Type                  = 1-byte
        - Simulation                    = 1-byte
        - APPID                         = 2-byte
        - APDU Length                   = 2-byte
        - GOOSE PDU                     = APDU Length - 2

        - Signature TAG                 = 0x85
        - Signature Length              = 1-byte
        - Authentication Tag            = Signature-length-bytes 
</pre></dd></dl>
<p>This header file declares the several funtions implemented on the file r_goose_security.c. Also, this file includes all of the other files and libraries used to modify and secure R-GOOSE Messages (OpenSSL, C Standard Libraries). </p><dl class="section note"><dt>Note</dt><dd>This library was tested using OpenSSL 1.1.1 library. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a7590c8b58b8ea2be81661365d4eccf46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7590c8b58b8ea2be81661365d4eccf46">&#9670;&nbsp;</a></span>r_goose_dissect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void r_goose_dissect </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that dissects and prints the R-GOOSE message. </p>
<p>This function dissects and prints the R-GOOSE message. It receives the message (<code>buffer</code>), iterates over its data and presents it in a user-friendly way. This is an auxiliary function.</p>
<p>Below is and example of usage: </p><div class="fragment"><div class="line">uint8_t* buffer = receive_packet();                     <span class="comment">// pseudo-function that receives a packet</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="r__goose__security_8h.html#a7590c8b58b8ea2be81661365d4eccf46">r_goose_dissect</a>(buffer);</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>Pointer (<code>uint8_t*</code>) containg the R-GOOSE message </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function doesn't return any value. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The packet format must be the same as specified on the top the this page. </dd></dl>

</div>
</div>
<a id="ae2233d1cff4fb1f4558b383f2ede6680"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2233d1cff4fb1f4558b383f2ede6680">&#9670;&nbsp;</a></span>r_gooseMessage_Decrypt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int r_gooseMessage_Decrypt </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>iv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iv_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that decrypts the GOOSE payload of an R-GOOSE message. </p>
<p>This function decrypts the GOOSE payload inside an R-GOOSE message. It receives the R-GOOSE message (<code>buffer</code>), the key that is going to be used (<code>key</code>), the Initialization Vector (<code>iv</code>) and its size (<code>iv_size</code>). The decryption algorithm to be used is also specified inside the message itself, and the supported algorithms can be found on <a class="el" href="r__goose__security_8h.html" title="File containing HMAC, GMAC and AES related imports, as well as the declarations of several R-GOOSE Pr...">r_goose_security.h</a>.</p>
<p>Below is and example of usage: </p><div class="fragment"><div class="line">uint8_t* buffer = receive_packet();                     <span class="comment">// pseudo-function that receives a packet</span></div>
<div class="line">uint8_t* key = (uint8_t*)malloc(<span class="keyword">sizeof</span>(uint8_t)*32);</div>
<div class="line">set_key(key);                                           <span class="comment">// pseudo-function that populates key </span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> key_size = 32;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> res = <a class="code" href="r__goose__security_8h.html#ae2233d1cff4fb1f4558b383f2ede6680">r_gooseMessage_Decrypt</a>(buffer, key, iv, iv_size);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(res == 1){</div>
<div class="line">    printf(<span class="stringliteral">&quot;Decrytpion success\n&quot;</span>);</div>
<div class="line">}<span class="keywordflow">else</span> <span class="keywordflow">if</span>(res == 0){</div>
<div class="line">    printf(<span class="stringliteral">&quot;Non Encryption\n&quot;</span>);</div>
<div class="line">}<span class="keywordflow">else</span>{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error while decrypting\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>Pointer (<code>uint8_t*</code>) containg the R-GOOSE message </td></tr>
    <tr><td class="paramname">key</td><td>Pointer (<code>uint8_t*</code>) containg the key that will be used to decrypt the GOOSE Payload </td></tr>
    <tr><td class="paramname">iv</td><td>Pointer (<code>uint8_t*</code>) containg the Initialization Vector to be used in decryption </td></tr>
    <tr><td class="paramname">iv_size</td><td>Variable (<code>size_t</code>) that hold the size in bytes of IV. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns -1 if an error occurred, 0 if the decryption algorithm was set to None Encryption and 1 if the GOOSE Payload was correctly decrypted. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The packet format must be the same as specified on the top the this page. </dd></dl>

</div>
</div>
<a id="af2d26cddbf81e39943e7f6db8f4753ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2d26cddbf81e39943e7f6db8f4753ec">&#9670;&nbsp;</a></span>r_gooseMessage_Encrypt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int r_gooseMessage_Encrypt </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>alg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timeOfCurrentKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>timeToNextKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>key_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>iv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iv_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that encrypts the GOOSE payload of an R-GOOSE message. </p>
<p>This function encrypts the GOOSE payload inside an R-GOOSE message. It receives the R-GOOSE message (<code>buffer</code>) and several security information related paramenters that are going to be updated on the original message. The encryption algorithm to be used is also specified as an argument(<code>alg</code>), and the valid values can be found on <a class="el" href="r__goose__security_8h.html" title="File containing HMAC, GMAC and AES related imports, as well as the declarations of several R-GOOSE Pr...">r_goose_security.h</a>. The security parameters are the specified in the R-GOOSE protocol being TimeOfCurrentKey, TimeToNextKey and KeyID.</p>
<p>Below is and example of usage: </p><div class="fragment"><div class="line">uint8_t* buffer = receive_packet();                     <span class="comment">// pseudo-function that receives a packet</span></div>
<div class="line">uint8_t* key = (uint8_t*)malloc(<span class="keyword">sizeof</span>(uint8_t)*32);</div>
<div class="line">set_key(key);                                           <span class="comment">// pseudo-function that populates key </span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> key_size = 32;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> res = <a class="code" href="r__goose__security_8h.html#af2d26cddbf81e39943e7f6db8f4753ec">r_gooseMessage_Encrypt</a>(buffer, key, AES_256_GCM, TimeOfCurrentKey, TimeToNextKey, KeyID, iv, iv_size);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(res == 1){</div>
<div class="line">    printf(<span class="stringliteral">&quot;Encryption success\n&quot;</span>);</div>
<div class="line">}<span class="keywordflow">else</span> <span class="keywordflow">if</span>(res == 0){</div>
<div class="line">    printf(<span class="stringliteral">&quot;Non Encryption success\n&quot;</span>);</div>
<div class="line">}<span class="keywordflow">else</span>{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error while encrypting\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>Pointer (<code>uint8_t*</code>) containg the R-GOOSE message </td></tr>
    <tr><td class="paramname">key</td><td>Pointer (<code>uint8_t*</code>) containg the key that will be used to encrypt the GOOSE Payload </td></tr>
    <tr><td class="paramname">alg</td><td>Variable (<code>int</code>) contaning the reference to the encryption algorithm to be used (specified in <a class="el" href="r__goose__security_8h.html" title="File containing HMAC, GMAC and AES related imports, as well as the declarations of several R-GOOSE Pr...">r_goose_security.h</a>) </td></tr>
    <tr><td class="paramname">timeOfCurrentKey</td><td>Variable (<code>uint32_t</code>) contaning the value specifying the time value of the current key in use. Used to update R-GOOSE packet </td></tr>
    <tr><td class="paramname">timeToNextKey</td><td>Variable (<code>uint16_t</code>) contaning the value specifying the time in minutes to the next key. Used to update R-GOOSE packet </td></tr>
    <tr><td class="paramname">key_id</td><td>Variable (<code>uint32_t</code>) containing the ID of the key being used, as a reference to the Key Management Scheme in use. Used to update R-GOOSE packet </td></tr>
    <tr><td class="paramname">iv</td><td>Pointer (<code>uint8_t*</code>) containg the Initialization Vector to be used in encryption </td></tr>
    <tr><td class="paramname">iv_size</td><td>Variable (<code>size_t</code>) that hold the size in bytes of IV. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns -1 if an error occurred, 0 if the encryption algorithm was set to None Encryption and 1 if the GOOSE Payload was correctly encrypted. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The packet format must be the same as specified on the top the this page. </dd></dl>

</div>
</div>
<a id="ad6a00bd3ec7cc19913cf4cbb065f0bd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6a00bd3ec7cc19913cf4cbb065f0bd6">&#9670;&nbsp;</a></span>r_gooseMessage_InsertGMAC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int r_gooseMessage_InsertGMAC </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>alg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that generate and insert an GMAC Tag into an R-GOOSE message. </p>
<p>This function generate an GMAC Tag and insert it into an R-GOOSE message, updating the mutable fields of the protocol. The R-GOOSE message is received by a parameter, <code>buffer</code>, a pointer to the message itself, and generates the GMAC acordding to the specified algorithm (<code>alg</code>). The resulting tag is stored directly on the original message. The parameter <code>alg</code>, is a constant that could be found on <a class="el" href="r__goose__security_8h.html" title="File containing HMAC, GMAC and AES related imports, as well as the declarations of several R-GOOSE Pr...">r_goose_security.h</a>.</p>
<p>Below is and example of usage: </p><div class="fragment"><div class="line">uint8_t* buffer = receive_packet();                     <span class="comment">// pseudo-function that receives a packet</span></div>
<div class="line">uint8_t* key = (uint8_t*)malloc(<span class="keyword">sizeof</span>(uint8_t)*16);</div>
<div class="line">set_key(key);                                           <span class="comment">// pseudo-function that populates key </span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> key_size = 16;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="r__goose__security_8h.html#ad6a00bd3ec7cc19913cf4cbb065f0bd6">r_gooseMessage_InsertGMAC</a>(buffer, key, key_size, GMAC_AES128_128);</div>
<div class="line"> </div>
<div class="line">print_message(buffer);                                  <span class="comment">// pseudo-function that prints the resulting message</span></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>Pointer (<code>uint8_t*</code>) containg to the R-GOOSE message </td></tr>
    <tr><td class="paramname">key</td><td>Pointer (<code>uint8_t*</code>) containg the key that will be used to generate the GMAC Tag </td></tr>
    <tr><td class="paramname">key_size</td><td>Variable (<code>size_t</code>) that hold the size in bytes of key. </td></tr>
    <tr><td class="paramname">alg</td><td>Variable (<code>int</code>) that specifies the algorithm that will be used to generate de GMAC Tag. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns -1 if an error occurred and 1 if the GMAC tag was successfully generated and inserted. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The packet format must be the same as specified on the top the this page. </dd>
<dd>
If an unknown <code>alg</code> is given (not specified on <a class="el" href="r__goose__security_8h.html" title="File containing HMAC, GMAC and AES related imports, as well as the declarations of several R-GOOSE Pr...">r_goose_security.h</a>) the function returns -1, as an error. </dd></dl>
<dl class="section note"><dt>Note</dt><dd><code>key</code> and <code>key_size</code> must be defined according the specified algorithm <code>alg</code>. If AES128-GCM is used, then a 16 bytes long key should be given, although, if AES256-GCM is used, a 32 bytes key should be given. </dd>
<dd>
For now, the Initialization Vector (IV) is constant and defined inside the function as all-zeros byte array. </dd></dl>

</div>
</div>
<a id="ab36f165524ae0178166b93bcfc9d8e7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab36f165524ae0178166b93bcfc9d8e7b">&#9670;&nbsp;</a></span>r_gooseMessage_InsertHMAC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int r_gooseMessage_InsertHMAC </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>alg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that generate and insert an HMAC Tag into an R-GOOSE message. </p>
<p>This function generate an HMAC Tag and insert it into an R-GOOSE message, updating the mutable fields of the protocol. The R-GOOSE message is received by a parameter, <code>buffer</code>, a pointer to the message itself, and generates the HMAC acordding to the specified algorithm (<code>alg</code>). The resulting tag is stored directly on the original message. The parameter <code>alg</code>, is a constant that could be found on <a class="el" href="r__goose__security_8h.html" title="File containing HMAC, GMAC and AES related imports, as well as the declarations of several R-GOOSE Pr...">r_goose_security.h</a>.</p>
<p>Below is and example of usage: </p><div class="fragment"><div class="line">uint8_t* buffer = receive_packet();                     <span class="comment">// pseudo-function that receives a packet</span></div>
<div class="line">uint8_t* key = (uint8_t*)malloc(<span class="keyword">sizeof</span>(uint8_t)*20);</div>
<div class="line">set_key(key);                                           <span class="comment">// pseudo-function that populates key </span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> key_size = 20;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="r__goose__security_8h.html#ab36f165524ae0178166b93bcfc9d8e7b">r_gooseMessage_InsertHMAC</a>(buffer, key, key_size, HMAC_SHA256_80);</div>
<div class="line"> </div>
<div class="line">print_message(buffer);                                  <span class="comment">// pseudo-function that prints the resulting message</span></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>Pointer (<code>uint8_t*</code>) containg to the R-GOOSE message </td></tr>
    <tr><td class="paramname">key</td><td>Pointer (<code>uint8_t*</code>) containg the key that will be used to generate the HMAC Tag </td></tr>
    <tr><td class="paramname">key_size</td><td>Variable (<code>size_t</code>) that hold the size in bytes of key. </td></tr>
    <tr><td class="paramname">alg</td><td>Variable (<code>int</code>) that specifies the algorithm that will be used to generate de HMAC Tag. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns -1 if an error occurred and 1 if the HMAC tag was successfully generated and inserted. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The packet format must be the same as specified on the top the this page. </dd>
<dd>
If an unknown <code>alg</code> is given (not specified on <a class="el" href="r__goose__security_8h.html" title="File containing HMAC, GMAC and AES related imports, as well as the declarations of several R-GOOSE Pr...">r_goose_security.h</a>) the function returns -1, as an error. </dd></dl>

</div>
</div>
<a id="af5e7870fb388bedaac144151024c8308"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5e7870fb388bedaac144151024c8308">&#9670;&nbsp;</a></span>r_gooseMessage_ValidateGMAC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int r_gooseMessage_ValidateGMAC </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that validates or invalidates an R-GOOSE message containing an GMAC Tag. </p>
<p>This function analysis the GMAC Tag (if it exists) on a R-GOOSE message, and, if the tag is valid, it indicates the message as valid, otherwise, the message as invalid. This evaluation is done by generating the expected GMAC Tag, according to the information in the packet (Security Information-&gt;MAC Algorithm [index 23]) and comparing it with the one appended to the message. If both are equal, then the message is valid (the message was not changed during transportation), otherwise, the message was tampered, being invalid. The function receives R-GOOSE message (<code>buffer</code>), the key that should be used to generate the GMAC (<code>key</code>) and the key size (<code>key_size</code>). The message is only evaluated, meaning that the GMAC Tag is not removed.</p>
<p>Below is and example of usage: </p><div class="fragment"><div class="line">uint8_t* buffer = receive_packet();                     <span class="comment">// pseudo-function that receives a packet</span></div>
<div class="line">uint8_t* key = (uint8_t*)malloc(<span class="keyword">sizeof</span>(uint8_t)*20);</div>
<div class="line">set_key(key);                                           <span class="comment">// pseudo-function that populates key </span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> key_size = 20;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>((res = <a class="code" href="r__goose__security_8h.html#af5e7870fb388bedaac144151024c8308">r_gooseMessage_ValidateGMAC</a>(buffer, key, key_size)) == 1){</div>
<div class="line">    printf(<span class="stringliteral">&quot;Tag is valid.\n&quot;</span>);</div>
<div class="line">}<span class="keywordflow">else</span> <span class="keywordflow">if</span>(res == 2){</div>
<div class="line">    printf(<span class="stringliteral">&quot;Packet without Authentication Tag\n&quot;</span>);</div>
<div class="line">}<span class="keywordflow">else</span> <span class="keywordflow">if</span>(res = 0){</div>
<div class="line">    printf(<span class="stringliteral">&quot;Invalid Tag/Packet\n&quot;</span>);</div>
<div class="line">}<span class="keywordflow">else</span>{  </div>
<div class="line">    printf(<span class="stringliteral">&quot;Invalid Tag/Packet - [Error]\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>Pointer (<code>uint8_t*</code>) containg to the R-GOOSE message </td></tr>
    <tr><td class="paramname">key</td><td>Pointer (<code>uint8_t*</code>) containg the key that will be used to generate the GMAC Tag </td></tr>
    <tr><td class="paramname">key_size</td><td>Variable (<code>size_t</code>) that hold the size in bytes of key. <br  />
 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns -1 if an error occurred, 0 if the generated GMAC doesn't matches the provided in the packet (message is invalid), 1 if the generated GMAC matches with the one provided (message is valid) and 2 if the message doesn't contain the GMAC (not secured message) </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The packet format must be the same as specified on the top the this page. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>For now, the Initialization Vector (IV) is constant and defined inside the function as all-zeros byte array. </dd></dl>

</div>
</div>
<a id="a11691f1350b5aa209c05c76f223a83ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11691f1350b5aa209c05c76f223a83ef">&#9670;&nbsp;</a></span>r_gooseMessage_ValidateHMAC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int r_gooseMessage_ValidateHMAC </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that validates or invalidates an R-GOOSE message containing an HMAC Tag. </p>
<p>This function analysis the HMAC Tag (if it exists) on a R-GOOSE message, and, if the tag is valid, it indicates the message as valid, otherwise, the message as invalid. This evaluation is done by generating the expected HMAC Tag, according to the information in the packet (Security Information-&gt;MAC Algorithm [index 23]) and comparing it with the one appended to the message. If both are equal, then the message is valid (the message was not changed during transportation), otherwise, the message was tampered, being invalid. The function receives R-GOOSE message (<code>buffer</code>), the key that should be used to generate the HMAC (<code>key</code>) and the key size (<code>key_size</code>). The message is only evaluated, meaning that the HMAC Tag is not removed.</p>
<p>Below is and example of usage: </p><div class="fragment"><div class="line">uint8_t* buffer = receive_packet();                     <span class="comment">// pseudo-function that receives a packet</span></div>
<div class="line">uint8_t* key = (uint8_t*)malloc(<span class="keyword">sizeof</span>(uint8_t)*20);</div>
<div class="line">set_key(key);                                           <span class="comment">// pseudo-function that populates key </span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> key_size = 20;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>((res = <a class="code" href="r__goose__security_8h.html#a11691f1350b5aa209c05c76f223a83ef">r_gooseMessage_ValidateHMAC</a>(buffer, key, key_size)) == 1){</div>
<div class="line">    printf(<span class="stringliteral">&quot;Tag is valid.\n&quot;</span>);</div>
<div class="line">}<span class="keywordflow">else</span> <span class="keywordflow">if</span>(res == 2){</div>
<div class="line">    printf(<span class="stringliteral">&quot;Packet without Authentication Tag\n&quot;</span>);</div>
<div class="line">}<span class="keywordflow">else</span> <span class="keywordflow">if</span>(res = 0){</div>
<div class="line">    printf(<span class="stringliteral">&quot;Invalid Tag/Packet\n&quot;</span>);</div>
<div class="line">}<span class="keywordflow">else</span>{  </div>
<div class="line">    printf(<span class="stringliteral">&quot;Invalid Tag/Packet - [Error]\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>Pointer (<code>uint8_t*</code>) containg to the R-GOOSE message </td></tr>
    <tr><td class="paramname">key</td><td>Pointer (<code>uint8_t*</code>) containg the key that will be used to generate the HMAC Tag </td></tr>
    <tr><td class="paramname">key_size</td><td>Variable (<code>size_t</code>) that hold the size in bytes of key. <br  />
 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The function returns -1 if an error occurred, 0 if the generated HMAC doesn't matches the provided in the packet (message is invalid), 1 if the generated HMAC matches with the one provided (message is valid) and 2 if the message doesn't contain the HMAC (not secured message) </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The packet format must be the same as specified on the top the this page. </dd></dl>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="ar__goose__security_8h_html_a7590c8b58b8ea2be81661365d4eccf46"><div class="ttname"><a href="r__goose__security_8h.html#a7590c8b58b8ea2be81661365d4eccf46">r_goose_dissect</a></div><div class="ttdeci">void r_goose_dissect(uint8_t *buffer)</div><div class="ttdoc">Function that dissects and prints the R-GOOSE message.</div><div class="ttdef"><b>Definition:</b> r_goose_security.c:587</div></div>
<div class="ttc" id="ar__goose__security_8h_html_a11691f1350b5aa209c05c76f223a83ef"><div class="ttname"><a href="r__goose__security_8h.html#a11691f1350b5aa209c05c76f223a83ef">r_gooseMessage_ValidateHMAC</a></div><div class="ttdeci">int r_gooseMessage_ValidateHMAC(uint8_t *buffer, uint8_t *key, size_t key_size)</div><div class="ttdoc">Function that validates or invalidates an R-GOOSE message containing an HMAC Tag.</div><div class="ttdef"><b>Definition:</b> r_goose_security.c:177</div></div>
<div class="ttc" id="ar__goose__security_8h_html_ad6a00bd3ec7cc19913cf4cbb065f0bd6"><div class="ttname"><a href="r__goose__security_8h.html#ad6a00bd3ec7cc19913cf4cbb065f0bd6">r_gooseMessage_InsertGMAC</a></div><div class="ttdeci">int r_gooseMessage_InsertGMAC(uint8_t *buffer, uint8_t *key, size_t key_size, int alg)</div><div class="ttdoc">Function that generate and insert an GMAC Tag into an R-GOOSE message.</div><div class="ttdef"><b>Definition:</b> r_goose_security.c:269</div></div>
<div class="ttc" id="ar__goose__security_8h_html_af2d26cddbf81e39943e7f6db8f4753ec"><div class="ttname"><a href="r__goose__security_8h.html#af2d26cddbf81e39943e7f6db8f4753ec">r_gooseMessage_Encrypt</a></div><div class="ttdeci">int r_gooseMessage_Encrypt(uint8_t *buffer, uint8_t *key, int alg, uint32_t timeOfCurrentKey, uint16_t timeToNextKey, uint32_t key_id, uint8_t *iv, int iv_size)</div><div class="ttdoc">Function that encrypts the GOOSE payload of an R-GOOSE message.</div><div class="ttdef"><b>Definition:</b> r_goose_security.c:488</div></div>
<div class="ttc" id="ar__goose__security_8h_html_af5e7870fb388bedaac144151024c8308"><div class="ttname"><a href="r__goose__security_8h.html#af5e7870fb388bedaac144151024c8308">r_gooseMessage_ValidateGMAC</a></div><div class="ttdeci">int r_gooseMessage_ValidateGMAC(uint8_t *buffer, uint8_t *key, size_t key_size)</div><div class="ttdoc">Function that validates or invalidates an R-GOOSE message containing an GMAC Tag.</div><div class="ttdef"><b>Definition:</b> r_goose_security.c:383</div></div>
<div class="ttc" id="ar__goose__security_8h_html_ab36f165524ae0178166b93bcfc9d8e7b"><div class="ttname"><a href="r__goose__security_8h.html#ab36f165524ae0178166b93bcfc9d8e7b">r_gooseMessage_InsertHMAC</a></div><div class="ttdeci">int r_gooseMessage_InsertHMAC(uint8_t *buffer, uint8_t *key, size_t key_size, int alg)</div><div class="ttdoc">Function that generate and insert an HMAC Tag into an R-GOOSE message.</div><div class="ttdef"><b>Definition:</b> r_goose_security.c:23</div></div>
<div class="ttc" id="ar__goose__security_8h_html_ae2233d1cff4fb1f4558b383f2ede6680"><div class="ttname"><a href="r__goose__security_8h.html#ae2233d1cff4fb1f4558b383f2ede6680">r_gooseMessage_Decrypt</a></div><div class="ttdeci">int r_gooseMessage_Decrypt(uint8_t *buffer, uint8_t *key, uint8_t *iv, int iv_size)</div><div class="ttdoc">Function that decrypts the GOOSE payload of an R-GOOSE message.</div><div class="ttdef"><b>Definition:</b> r_goose_security.c:538</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
